DROP TABLE users, friendships, MPA_ratings, films, genres, film_genres, likes CASCADE;

CREATE TABLE IF NOT EXISTS users (
	id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	email varchar(90),
	login varchar(90),
	name varchar(90),
	birthday date
);

CREATE TABLE IF NOT EXISTS friendships (
	id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	user_id INTEGER REFERENCES users (id) ON DELETE CASCADE,
	friend_id INTEGER REFERENCES users (id) ON DELETE CASCADE,
	status boolean
);

CREATE TABLE IF NOT EXISTS MPA_ratings (
	id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	name varchar(90)
);

CREATE TABLE IF NOT EXISTS films (
	id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	name varchar(90),
	description varchar(90),
	release_date date,
	duration int,
	MPA_rating_id INTEGER REFERENCES MPA_ratings (id) ON DELETE SET NULL
);

CREATE TABLE IF NOT EXISTS genres (
	id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	name varchar(90)
);

CREATE TABLE IF NOT EXISTS film_genres (
	id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	film_id INTEGER REFERENCES films (id) ON DELETE CASCADE,
	genre_id INTEGER REFERENCES genres (id) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS likes (
	id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	user_id INTEGER REFERENCES users (id) ON DELETE CASCADE,
	film_id INTEGER REFERENCES films (id) ON DELETE CASCADE
);